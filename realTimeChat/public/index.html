<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colorful Real-time Chat</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="chat-header">
        <h1>Real-time Chatroom</h1>
        <p>Connect and chat instantly!</p>
    </header>

    <ul id="messages" class="messages-list"></ul>

    <form id="form" class="chat-form">
        <input id="input" autocomplete="off" placeholder="Type your message..." class="chat-input" />
        <button class="send-button">Send</button>
    </form>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io(); // Connects to the server where this HTML is served from

        let mySocketId; // Variable to store this client's own socket ID

        // Store this client's socket ID when connected
        socket.on('connect', () => {
            mySocketId = socket.id;
            console.log('Connected with ID:', mySocketId);
        });

        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const messages = document.getElementById('messages');

        // Send message when form is submitted
        form.addEventListener('submit', (e) => {
            e.preventDefault(); // Prevent default form submission and page reload
            if (input.value) {
                // Emit 'chat message' event to the server
                // The server will add the socket ID before broadcasting
                socket.emit('chat message', input.value);
                input.value = ''; // Clear input field
            }
        });

        // Listen for 'chat message' events from the server
        socket.on('chat message', (data) => {
            const item = document.createElement('li');
            item.textContent = data.message;

            // Check if the message was sent by this client or another
            if (data.id === mySocketId) {
                item.classList.add('sent-message'); // Apply 'sent' styling
            } else {
                item.classList.add('received-message'); // Apply 'received' styling
            }

            messages.appendChild(item);
            // Scroll to the bottom of the messages list
            messages.scrollTop = messages.scrollHeight;
        });

        // Basic error handling for connection (optional, but good practice)
        socket.on('connect_error', (err) => {
            console.error(`Connection error: ${err.message}`);
            const item = document.createElement('li');
            item.classList.add('system-message');
            item.textContent = 'Connection error. Please refresh the page.';
            messages.appendChild(item);
            messages.scrollTop = messages.scrollHeight;
        });

        socket.on('disconnect', (reason) => {
            console.log(`Disconnected: ${reason}`);
            const item = document.createElement('li');
            item.classList.add('system-message');
            item.textContent = 'You have been disconnected from the chat.';
            messages.appendChild(item);
            messages.scrollTop = messages.scrollHeight;
        });
    </script>
</body>
</html>
